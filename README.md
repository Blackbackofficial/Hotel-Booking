# Hotels Booking System

## Требования к программной реализации

1. В соответствии с вариантом задания реализовать систему, состоящую из нескольких взаимодействующих друг с другом сервисов. 
 Каждый сервис реализует свою функциональность и взаимодействует с другими сервисами по протоколу HTTP (придерживаться нотации RESTful), либо через очередь. 
 Также для межсервисного взаимодействия допускается использовать другие протоколы, например gRPC.
 
1. Каждый сервис имеет свое собственное хранилище, если оно ему нужно.
 
1. Выделить отдельный сервис Авторизации (Session Service), который хранит в себе информацию о пользователях и
 используется для пользовательской авторизации и аутентификации.
 
1. Для авторизации пользователь отправляет login + password, в ответ получает JWT токен. Токен выдает Session Service,
 валидация токена выполняется так же на Session Service. Пароли хранить в базе в хэшированном виде. 
 
1. Также выделить Gateway Service, который будет единой точкой входа в систему. Все запросы, кроме авторизации пользователя,
 проходят через него. 
 
1. Валидацию пользовательского JWT-токена также выполняет сервис Gateway. 
 
1. Т.к. компоненты системы смотрят в интернет, реализовать межсервисную авторизацию. Пример:
    * если сервису A требуется сделать запрос к сервису B, то он должен получить для этого токен; 
    * сервис A имеет некоторые clientId / clientSecret, которые он передает как basic-авторизацию в сервис B и 
      сервис B возвращает в ответ подписанный JWT-токен;
    * система A сохраняет этот токен у себя и все следующие запросы выполняет с ним;
    * токен имеет время жизни, если время жизни у него закончилось, то сервис B вернет HTTP 403:Forbidden ошибку, 
      значит сервису A нужно повторно получить токен у системы B и повторить запрос с новым токеном; 
    * в межсервисной авторизации участвуют только системы A и B, Session Service не задействован.

1. Реализовать пользовательский интерфейс HTML+CSS, желательно SPA (react, angular, vue) или мобильный клиент.
 Использование CSS обязательно. 
 
1. Запросы от UI могут быть к только к сервису Gateway либо Session Service для получения токена. 
 
1. Реализовать валидацию входных данных как на front-end’е, так и на back-end’е. 
 
1. Реализовать ролевую модель, создать минимум одного пользователя с ролью Admin и одного пользователя с ролью User. 
 
1. Выделить сервис статистики, туда отправлять через очередь статистику по операциям. В зависимости от задания
 по пришедшим данным строить отчет, доступ к которому должен быть только у пользователя с ролью Admin. 
 
1. Предусмотреть ситуацию недоступности систем, обработку таймаутов и ошибок сервисов. В случае ошибки/недоступности
 некритичного функционала выполнять деградацию функциональности. 
 
1. Весь код хранить на GitHub, автоматизировать процесс сборки, тестирования и релиза на внешней платформе.
 Для CI/CD использовать Github Actions. 
 
1. Каждому сервису поставить в соответствие доменное имя (возможно 3 или 4 уровня), главная страница должна открываться
 по основному имени. Например:
    * UI: aero-ticket.ru
    * Gateway: gw.air-ticket.ru
    * Airport Service: airport.air-ticket.ru

## Общие методы

1. Авторизация.
```
header: Authorization: basic(<login>:<password>)
POST /auth -> JWT token
```
1. Проверка токена пользователя.
```
header: Authorization: bearer <jwt>
POST /verify
```
1. Список всех пользователей. [A][G]
```
GET /users
```
1. Добавление нового пользователя. [A][G]
```
POST /users
body: { login, password }
```

Пояснение:
* [S] – требуют авторизации;
* [G] – запрос проходит через Gateway Service.
* [A] – требуют авторизации и прав администратора;
* [M] – операция модификации.

В блоке Структура данных описаны примерные связи между сервисами и сущностями, это не описание ER-диаграммы и не схема базы данных.

## Hotels Booking System

Система предоставляет пользователю сервис поиска и бронирования отелей на интересующие даты. В зависимости
от количества заказов система лояльности дает скидку пользователю на новые бронирования.

**Бизнес сервисы:**

* Гостиницы (Hotel Service)
*Система бронирования (Booking Service)
* Платежная система (Payment Service)
* Система лояльности (Loyalty Service)

**Дополнительные сервисы:**

* Gateway
* Авторизация (Session Service)
* Админка (Report Service)

### Структуры данных

**User (Session Service):**
```
+ login
+ password
+ user_uid
```

**Hotels (Hotel Service):**
```
+ name
+ location: { country, city, address }
+ hotel_uid
```

**Reservations (Booking Service):**
```
+ hotel_uid -> FK to Hotel Service (Hotels::hotel_uid)
+ user_uid -> FK to Session Service (User::user_uid)
+ payment_uid-> FK to Payment Service (Payment::payment_uid)
+ date
```

**Payments (Payment Service):**
```
+ payment_uid
+ status [NEW, PAID, REVERSED, CANCELED]
+ price
```

**UserLoyalty (Loyalty Service):**
```
+ user_uid -> FK to Session Service (User::user_uid)
+ status: [BRONZE, SILVER, GOLD]
+ discount
```

### Основные операции

Специфические для варианта задания:

1. Список отелей. [G]
    ```
    GET /hotels
    ```
1. Информация об отеле. [G]
    ```
    GET /hotels/{hotelUid}
    ```
1. Забронировать номер. [S][M][G]
    ```
    header: Authorization: bearer <jwt>
    POST /booking
    body: { hotelUid, room, paymentInfo }
    ```
1. Аннулировать бронь номера. [S][M][G]
    ```
    header: Authorization: bearer <jwt>
    DELETE /booking/{bookingUid}
    ```
1. Информация по бронированию. [S][G]
    ```
    header: Authorization: bearer <jwt>
    GET /booking/{bookingUid}
    ```
1. Посмотреть мои бронирования. [S][G]
    ```
    header: Authorization: bearer <jwt>
    GET /booking
    ```
1. Посмотреть баланс бонусной программы. [S][G]
    ```
    header: Authorization: bearer <jwt>
    GET /loyalty
    ```
1. Добавить отель. [A][M][G]
    ```
    header: Authorization: bearer <jwt>
    POST /hotels
    body: { rooms, name, address }
    ```
1. Изменить информацию о доступности комнат. [A][M][G]
    ```
    header: Authorization: bearer <jwt>
    PATCH /hotels/{hotelUid}/rooms
    body: { rooms: { number, interval, status } }
    ```
1. Посмотреть статистику бронирования по пользователям: при бронировании отеля данные отправляются в статистику. [A][G]
    ```
    header: Authorization: bearer <jwt>
    GET /reports/booking
    ```
1. Посмотреть статистику наполнения отелей: сколько мест на текущий момент свободно. [A][G]
    ```
    header: Authorization: bearer <jwt>
    GET /reports/hotels-filling
    ```
